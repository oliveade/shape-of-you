{% extends 'base.html.twig' %}

{% block body %}
    <div class="container mx-auto p-4">
        <h1 class="text-2xl sm:text-3xl md:text-4xl mb-4 text-center">Veuillez Prendre une photo de votre tenue</h1>

        <div class="flex justify-center items-center">
            <video id="video" class="border-2 border-gray-300 rounded-lg w-full sm:w-3/4 md:w-1/2" width="400" height="300" autoplay></video>
        </div>

        <div class="flex justify-center mt-4">
            <button id="captureButton" class="bg-blue-500 text-white px-6 py-3 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                Prendre une photo
            </button>
        </div>

        <div id="photoContainer" class="mt-4 hidden text-center">
            <h2 class="text-xl mb-2">Votre photo :</h2>
            <img id="photo" class="mx-auto max-w-full rounded-lg" width="400">
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const captureButton = document.getElementById('captureButton');
        const photoContainer = document.getElementById('photoContainer');
        const photo = document.getElementById('photo');

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                video.srcObject = stream;
            })
            .catch(function(err) {
                console.error("Erreur lors de l'accès à la caméra : ", err);
            });

        captureButton.addEventListener('click', function() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            photo.src = canvas.toDataURL('image/png');
            photoContainer.classList.remove('hidden');

            const photoData = canvas.toDataURL('image/png');
            fetch('/upload-photo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image: photoData })
            }).then(response => response.json())
              .then(data => {
                  console.log(data); 
              });
        });
    </script>
{% endblock %}
